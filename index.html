<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Coração com Pontinhos</title>
  <style>
    body {
      margin: 0;
      background: black;
      overflow: hidden;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.9.0/lib/p5.min.js"></script>
  <script>
    let points = [];
    let heartPoints = [];
    let animationComplete = false;
    let pulseScale = 1;
    let pulseDirection = 1;

    function setup() {
      createCanvas(windowWidth, windowHeight);
      noStroke();

      // Criação dos pontos aleatórios
      for (let i = 0; i < 200; i++) {
        points.push({
          x: random(width),
          y: random(height),
          targetX: 0,
          targetY: 0
        });
      }

      // Geração das coordenadas do coração
      for (let t = 0; t < TWO_PI; t += 0.05) {
        let x = 16 * pow(sin(t), 3);
        let y = - (13 * cos(t) - 5 * cos(2 * t) - 2 * cos(3 * t) - cos(4 * t));
        heartPoints.push({ x: x, y: y });
      }

      // Escalando o coração e definindo alvos dos pontos
      let scaleFactor = min(width, height) / 40;
      for (let i = 0; i < points.length; i++) {
        let h = heartPoints[i % heartPoints.length];
        points[i].targetX = width / 2 + h.x * scaleFactor;
        points[i].targetY = height / 2 + h.y * scaleFactor;
      }
    }

    function draw() {
      background(0);
      fill(255, 0, 0);

      animationComplete = true;

      for (let i = 0; i < points.length; i++) {
        let p = points[i];
        let dx = p.targetX - p.x;
        let dy = p.targetY - p.y;

        if (abs(dx) > 0.1 || abs(dy) > 0.1) {
          p.x += dx * 0.05;
          p.y += dy * 0.05;
          animationComplete = false;
        }

        // Aplica o "pulso" se a animação tiver terminado
        let px = p.x;
        let py = p.y;
        if (animationComplete) {
          px = width/2 + (p.x - width/2) * pulseScale;
          py = height/2 + (p.y - height/2) * pulseScale;
        }

        ellipse(px, py, 6);
      }

      // Lógica do pulso
      if (animationComplete) {
        pulseScale += pulseDirection * 0.005;
        if (pulseScale > 1.05 || pulseScale < 0.95) {
          pulseDirection *= -1;
        }
      }
    }

    function windowResized() {
      resizeCanvas(windowWidth, windowHeight);
    }
  </script>
</body>
</html>
